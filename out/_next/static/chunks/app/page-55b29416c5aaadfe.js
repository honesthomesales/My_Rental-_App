(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{3081:function(e,t,a){Promise.resolve().then(a.bind(a,5054))},5054:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return p}});var s=a(7573),n=a(7653),r=a(1695),l=a(3172),i=a(5155),c=a(1797),o=a(3989),d=a(8177),u=a(5731),m=a(2548),x=a(6286),h=a(9369);function p(){let e=(0,r.useRouter)(),[t,a]=(0,n.useState)([]),[p,y]=(0,n.useState)({total_properties:0,total_tenants:0,outstanding_balances:0,monthly_income:0,monthly_expenses:0,profit:0,total_bank_balance:0,late_tenants_count:0,property_type_breakdown:{house:0,singlewide:0,doublewide:0,land:0,loan:0}}),[g,f]=(0,n.useState)(!0),[b,j]=(0,n.useState)(""),[v,N]=(0,n.useState)(!1);(0,n.useEffect)(()=>{N(!0)},[]),(0,n.useEffect)(()=>{v&&w()},[v]);let w=(0,n.useCallback)(async()=>{try{f(!0);let[e,t]=await Promise.all([x.PropertiesService.getAll(),x.TenantsService.getAll()]),s=e.data,n=t.data;if(s){let e=s.map(e=>{var t,a,s,n,r,l,i,c,o,d,u,m,x,h,p,y;return{...e,bedrooms:null!==(t=e.bedrooms)&&void 0!==t?t:null,bathrooms:null!==(a=e.bathrooms)&&void 0!==a?a:null,square_feet:null!==(s=e.square_feet)&&void 0!==s?s:null,year_built:null!==(n=e.year_built)&&void 0!==n?n:null,purchase_price:null!==(r=e.purchase_price)&&void 0!==r?r:null,purchase_date:null!==(l=e.purchase_date)&&void 0!==l?l:null,current_value:null!==(i=e.current_value)&&void 0!==i?i:null,monthly_rent:null!==(c=e.monthly_rent)&&void 0!==c?c:null,insurance_policy_number:null!==(o=e.insurance_policy_number)&&void 0!==o?o:null,insurance_provider:null!==(d=e.insurance_provider)&&void 0!==d?d:null,insurance_expiry_date:null!==(u=e.insurance_expiry_date)&&void 0!==u?u:null,insurance_premium:null!==(m=e.insurance_premium)&&void 0!==m?m:null,owner_name:null!==(x=e.owner_name)&&void 0!==x?x:null,owner_phone:null!==(h=e.owner_phone)&&void 0!==h?h:null,owner_email:null!==(p=e.owner_email)&&void 0!==p?p:null,notes:null!==(y=e.notes)&&void 0!==y?y:null}});a(e);let t=_(e,n||[]);y(t)}}catch(e){console.error("Error loading dashboard data:",e),m.ZP.error("Failed to load dashboard data")}finally{f(!1)}},[]),_=(0,n.useCallback)((e,t)=>{let a=e.reduce((e,t)=>{let a=(0,h.S6)(t.notes||void 0);return e+(0,h.GN)(t.monthly_rent||0,a)},0),s=e.reduce((e,t)=>{let a=t.property_type||"house";return e[a]=(e[a]||0)+1,e},{});e&&e.length>0&&e.filter(e=>"rented"===e.status).length;let n=0,r=0;return t&&t.length>0&&(n=t.filter(t=>{try{let a=e.find(e=>e.id===t.property_id);if(!a||!t.leases||0===t.leases.length)return!1;return x.TenantsService.isTenantLate(t,a)}catch(e){return console.error("Error checking tenant late status:",e),!1}}).length,r=t.reduce((t,a)=>{try{let s=e.find(e=>e.id===a.property_id);if(s&&a.leases&&a.leases.length>0){let e=x.TenantsService.calculateTotalLatePayments(a,s);return t+e.totalDue}}catch(e){console.error("Error calculating outstanding for tenant:",e)}return t},0)),{total_properties:e.length,total_tenants:(null==t?void 0:t.length)||0,outstanding_balances:r,monthly_income:a,monthly_expenses:0,profit:a-0,total_bank_balance:0,late_tenants_count:n,property_type_breakdown:{house:s.house||0,singlewide:s.singlewide||0,doublewide:s.doublewide||0,land:s.land||0,loan:s.loan||0}}},[]),k=(0,n.useMemo)(()=>{if(!b.trim())return t;let e=b.toLowerCase();return t.filter(t=>t.name.toLowerCase().includes(e)||t.address.toLowerCase().includes(e)||t.city.toLowerCase().includes(e)||t.state.toLowerCase().includes(e))},[t,b]),L=(0,n.useCallback)(e=>{j(e.target.value)},[]);(0,n.useCallback)(t=>{e.push("/properties/".concat(t))},[e]);let S=(0,n.useCallback)(()=>{e.push("/properties/new")},[e]);(0,n.useCallback)(()=>{e.push("/properties")},[e]),(0,n.useCallback)(()=>{e.push("/tenants")},[e]);let T=(0,n.useCallback)(()=>{e.push("/late-payments")},[e]);return v?g?(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary-600"})}):(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,s.jsx)("header",{className:"bg-white shadow-sm border-b border-gray-200",children:(0,s.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,s.jsxs)("div",{className:"flex justify-between items-center py-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Rental Dashboard"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Manage your rental properties"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsxs)("button",{onClick:S,className:"btn btn-primary btn-lg",children:[(0,s.jsx)(l.Z,{className:"w-5 h-5 mr-2"}),"Add Property"]}),(0,s.jsxs)("button",{onClick:T,className:"btn btn-warning btn-lg",children:[(0,s.jsx)(i.Z,{className:"w-5 h-5 mr-2"}),"Late Payments"]})]})]})})}),(0,s.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-8",children:[(0,s.jsx)("div",{className:"card",children:(0,s.jsx)("div",{className:"card-content",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"p-2 bg-primary-100 rounded-lg",children:(0,s.jsx)(c.Z,{className:"w-6 h-6 text-primary-600"})}),(0,s.jsxs)("div",{className:"ml-4",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Properties"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:p.total_properties})]})]})})}),(0,s.jsx)("div",{className:"card",children:(0,s.jsx)("div",{className:"card-content",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"p-2 bg-success-100 rounded-lg",children:(0,s.jsx)(o.Z,{className:"w-6 h-6 text-success-600"})}),(0,s.jsxs)("div",{className:"ml-4",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Occupied"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:t.filter(e=>"rented"===e.status).length})]})]})})}),(0,s.jsx)("div",{className:"card",children:(0,s.jsx)("div",{className:"card-content",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"p-2 bg-warning-100 rounded-lg",children:(0,s.jsx)(d.Z,{className:"w-6 h-6 text-warning-600"})}),(0,s.jsxs)("div",{className:"ml-4",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Monthly Income"}),(0,s.jsxs)("p",{className:"text-2xl font-bold text-gray-900",children:["$",p.monthly_income.toLocaleString()]})]})]})})}),(0,s.jsx)("div",{className:"card cursor-pointer hover:shadow-lg transition-shadow",onClick:T,children:(0,s.jsx)("div",{className:"card-content",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"p-2 bg-danger-100 rounded-lg",children:(0,s.jsx)(i.Z,{className:"w-6 h-6 text-danger-600"})}),(0,s.jsxs)("div",{className:"ml-4",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Late Payments"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:p.late_tenants_count})]})]})})}),(0,s.jsx)("div",{className:"card cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>e.push("/late-payments"),children:(0,s.jsx)("div",{className:"card-content",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"p-2 bg-red-100 rounded-lg",children:(0,s.jsx)(d.Z,{className:"w-6 h-6 text-red-600"})}),(0,s.jsxs)("div",{className:"ml-4",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Outstanding"}),(0,s.jsxs)("p",{className:"text-2xl font-bold text-red-600",children:["$",p.outstanding_balances.toLocaleString()]})]})]})})})]}),(0,s.jsxs)("div",{className:"card mb-6",children:[(0,s.jsxs)("div",{className:"card-header",children:[(0,s.jsx)("h2",{className:"card-title",children:"Property Type Breakdown"}),(0,s.jsx)("p",{className:"card-description",children:"Distribution of your properties by type"})]}),(0,s.jsx)("div",{className:"card-content",children:(0,s.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[(0,s.jsxs)("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:p.total_properties}),(0,s.jsx)("div",{className:"text-sm text-gray-600",children:"Total"})]}),(0,s.jsxs)("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-green-600",children:p.property_type_breakdown.house}),(0,s.jsx)("div",{className:"text-sm text-gray-600",children:"House"})]}),(0,s.jsxs)("div",{className:"text-center p-4 bg-purple-50 rounded-lg",children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-purple-600",children:p.property_type_breakdown.doublewide}),(0,s.jsx)("div",{className:"text-sm text-gray-600",children:"Doublewide"})]}),(0,s.jsxs)("div",{className:"text-center p-4 bg-orange-50 rounded-lg",children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-orange-600",children:p.property_type_breakdown.singlewide}),(0,s.jsx)("div",{className:"text-sm text-gray-600",children:"Singlewide"})]}),(0,s.jsxs)("div",{className:"text-center p-4 bg-red-50 rounded-lg",children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-red-600",children:p.property_type_breakdown.loan}),(0,s.jsx)("div",{className:"text-sm text-gray-600",children:"Loan"})]})]})})]}),(0,s.jsxs)("div",{className:"card",children:[(0,s.jsx)("div",{className:"card-header",children:(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"card-title",children:"Properties"}),(0,s.jsx)("p",{className:"card-description",children:"Manage your rental properties"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(u.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),(0,s.jsx)("input",{type:"text",placeholder:"Search properties...",value:b,onChange:L,className:"pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),(0,s.jsx)("button",{className:"btn btn-secondary",children:"Filter"})]})]})}),(0,s.jsx)("div",{className:"card-content",children:(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Property"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Address"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Type"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Monthly Rent"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:k.map(t=>(0,s.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,s.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,s.jsx)("div",{className:"text-sm font-medium text-gray-900",children:t.name}),(0,s.jsxs)("div",{className:"text-sm text-gray-500",children:[t.city,", ",t.state]})]}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:t.address}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,s.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800",children:t.property_type})}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,s.jsx)("span",{className:"inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat("rented"===t.status?"bg-green-100 text-green-800":"empty"===t.status?"bg-gray-100 text-gray-800":"bg-yellow-100 text-yellow-800"),children:t.status})}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:t.monthly_rent?"".concat(t.monthly_rent.toLocaleString()," (").concat((0,h.S6)(t.notes||void 0),")"):"N/A"}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,s.jsx)("button",{onClick:()=>e.push("/properties/edit/?id=".concat(t.id)),className:"text-primary-600 hover:text-primary-900",children:"Edit"})})]},t.id))})]})})})]})]})]}):null}},9369:function(e,t,a){"use strict";function s(e,t){if(!e||!t)return e||0;switch(t.toLowerCase().trim()){case"weekly":return 4.33*e;case"bi-weekly":case"biweekly":case"bi_weekly":return 2.17*e;default:return e}}function n(e){if(!e)return"monthly";let t=e.match(/Rent cadence:\s*(\w+)/i);return t?t[1]:"monthly"}function r(e,t){if(!e)return"$0";let a=(null==t?void 0:t.toLowerCase().trim())||"monthly";return"$".concat(e.toLocaleString(),"/").concat(a)}function l(e,t,a){let s;let n=new Date(e);switch(a.toLowerCase().trim()){case"weekly":s=new Date(n.getTime()+6048e5*t);break;case"bi-weekly":case"biweekly":case"bi_weekly":s=new Date(n.getTime()+12096e5*t);break;default:(s=new Date(n)).setMonth(s.getMonth()+t)}return s}function i(e,t){if(console.log("calculateTotalLatePayments: Starting calculation for",e.first_name,e.last_name),!e||!t||!e.lease_start_date||!(null==t?void 0:t.monthly_rent))return console.log("calculateTotalLatePayments: Missing required data - tenant:",!!e,"property:",!!t,"lease_start_date:",null==e?void 0:e.lease_start_date,"monthly_rent:",null==t?void 0:t.monthly_rent),{totalLateFees:0,totalOutstanding:0,totalDue:0,latePeriods:0,payPeriods:[]};try{let a=n(t.notes),s=t.monthly_rent;console.log("calculateTotalLatePayments: Cadence:",a,"Monthly rent:",s);let r=s;"weekly"===a?r=s/4.33:("bi-weekly"===a||"biweekly"===a||"bi_weekly"===a)&&(r=s/2.17),console.log("Tenant calculation - Cadence:",a,"Monthly rent:",s,"Period rent:",r);let i=function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:12,s=[],n=new Date,r=0,i=l(e,0,t),c=0,o=3*a;for(;i<=n&&r<2*a&&c<o;)i=l(e,++r,t),c++;if(c>=o)return console.error("getLastExpectedPaymentDates: Safety limit reached, possible infinite loop detected"),[];r=Math.max(0,r-1);for(let i=Math.max(0,r-a+1);i<=r;i++){let a=l(e,i,t);a<=n&&s.push(a)}return s}(e.lease_start_date,a,12),c=0,o=0,d=0,u=i.map(t=>{let s=function(e,t,a,s){let n=function(e){switch(e.toLowerCase().trim()){case"weekly":return 10;case"bi-weekly":case"biweekly":case"bi_weekly":return 20;default:return 45}}(a),r=e.toISOString().split("T")[0];t&&Array.isArray(t)||(t=[]);let l=new Date(e);l.setDate(l.getDate()-2);let i=new Date(e);i.setDate(i.getDate()+5);let c=t.filter(e=>{let t=new Date(e.date);return t>=l&&t<=i&&"completed"===e.status}),o=c.reduce((e,t)=>e+t.amount,0),d=Math.max(0,s-o),u=new Date,m=0===c.length&&u>i;return(m&&console.log("LATE PERIOD:",{expectedDate:r,periodEnd:i.toISOString().split("T")[0],today:u.toISOString().split("T")[0],outstanding:d,lateFee:d>0?n:0}),m)?{isLate:!0,daysLate:Math.max(0,function(e,t){let a=new Date(e);return Math.ceil(Math.abs(new Date(t).getTime()-a.getTime())/864e5)}(i,u)),lateFees:d>0?n:0,totalPaid:o,outstanding:d}:{isLate:!1,daysLate:0,lateFees:0,totalPaid:o,outstanding:d}}(t,e.payment_history,a,r);return s.isLate&&(c+=s.lateFees,o+=s.outstanding,d++),{expectedDate:t,...s}}),m={totalLateFees:c,totalOutstanding:o,totalDue:c+o,latePeriods:d,payPeriods:u};return console.log("calculateTotalLatePayments: Final result for",e.first_name,e.last_name,":",m),m}catch(e){return console.error("Error calculating late payments:",e),{totalLateFees:0,totalOutstanding:0,totalDue:0,latePeriods:0,payPeriods:[]}}}function c(e,t){try{if(!e||!t)return console.log("isTenantLate: Missing tenant or property data"),!1;console.log("isTenantLate: Starting check for tenant",e.first_name,e.last_name),console.log("isTenantLate: Tenant lease_start_date:",e.lease_start_date),console.log("isTenantLate: Property monthly_rent:",t.monthly_rent);let a=i(e,t),s=a.totalDue>0;return console.log("isTenantLate: Result - Total due:",a.totalDue,"Is late:",s),s}catch(e){return console.error("Error checking if tenant is late:",e),!1}}a.d(t,{GN:function(){return s},S6:function(){return n},c1:function(){return i},eP:function(){return r},mq:function(){return c}})},5155:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(4313).Z)("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},8177:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(4313).Z)("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]])},1797:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(4313).Z)("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]])},3172:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(4313).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},5731:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(4313).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},3989:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});let s=(0,a(4313).Z)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]])},1695:function(e,t,a){"use strict";var s=a(1219);a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}}),a.o(s,"useSearchParams")&&a.d(t,{useSearchParams:function(){return s.useSearchParams}})}},function(e){e.O(0,[334,134,286,293,528,744],function(){return e(e.s=3081)}),_N_E=e.O()}]);