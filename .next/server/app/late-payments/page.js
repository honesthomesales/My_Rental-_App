(()=>{var e={};e.id=557,e.ids=[557],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},8893:e=>{"use strict";e.exports=require("buffer")},4770:e=>{"use strict";e.exports=require("crypto")},7702:e=>{"use strict";e.exports=require("events")},2615:e=>{"use strict";e.exports=require("http")},5240:e=>{"use strict";e.exports=require("https")},8216:e=>{"use strict";e.exports=require("net")},8621:e=>{"use strict";e.exports=require("punycode")},6162:e=>{"use strict";e.exports=require("stream")},2452:e=>{"use strict";e.exports=require("tls")},7360:e=>{"use strict";e.exports=require("url")},1568:e=>{"use strict";e.exports=require("zlib")},1223:()=>{},4837:()=>{},3347:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GlobalError:()=>n.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>c,routeModule:()=>p,tree:()=>o}),a(6070),a(7195),a(1025);var s=a(3282),r=a(5736),l=a(3906),n=a.n(l),i=a(6880),d={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>i[e]);a.d(t,d);let o=["",{children:["late-payments",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,6070)),"C:\\Projects\\Rental_App\\apps\\web\\app\\late-payments\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,7195)),"C:\\Projects\\Rental_App\\apps\\web\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(a.bind(a,1025)),"C:\\Projects\\Rental_App\\apps\\web\\app\\not-found.tsx"]}],c=["C:\\Projects\\Rental_App\\apps\\web\\app\\late-payments\\page.tsx"],u="/late-payments/page",m={require:a,loadChunk:()=>Promise.resolve()},p=new s.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/late-payments/page",pathname:"/late-payments",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},4541:(e,t,a)=>{Promise.resolve().then(a.bind(a,3122))},869:(e,t,a)=>{Promise.resolve().then(a.bind(a,8130)),Promise.resolve().then(a.bind(a,4155))},6406:(e,t,a)=>{Promise.resolve().then(a.t.bind(a,4424,23)),Promise.resolve().then(a.t.bind(a,7752,23)),Promise.resolve().then(a.t.bind(a,5275,23)),Promise.resolve().then(a.t.bind(a,9842,23)),Promise.resolve().then(a.t.bind(a,1633,23)),Promise.resolve().then(a.t.bind(a,9224,23))},6407:(e,t,a)=>{Promise.resolve().then(a.t.bind(a,6568,23))},3122:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>m});var s=a(3227),r=a(3677),l=a(1043),n=a(3726);class i{static async getAll(e){try{let t=(0,n.Ng)(),a=t.from("RENT_tenants").select("*").order("created_at",{ascending:!1});e?.property_id&&(a=a.eq("property_id",e.property_id)),e?.is_active!==void 0&&(a=a.eq("is_active",e.is_active)),e?.late_status&&(a=a.eq("late_status",e.late_status));let{data:s,error:r}=await a;if(r)return(0,n.ql)(null,(0,n.Iu)(r));let l=await Promise.all(s.map(async e=>{let a=null;if(e.property_id){let{data:s}=await t.from("RENT_properties").select("id, name, address, notes, monthly_rent").eq("id",e.property_id).single();a=s}let{data:s}=await t.from("RENT_leases").select("*").eq("tenant_id",e.id).order("lease_start_date",{ascending:!1});return{...e,properties:a,leases:s||[]}}));return(0,n.ql)(l)}catch(e){return(0,n.ql)(null,(0,n.Iu)(e))}}static async getById(e){try{let t=(0,n.Ng)(),{data:a,error:s}=await t.from("RENT_tenants").select("*").eq("id",e).single();if(s)return(0,n.ql)(null,(0,n.Iu)(s));let r=null;if(a.property_id){let{data:e}=await t.from("RENT_properties").select("id, name, address, notes, monthly_rent").eq("id",a.property_id).single();r=e}let{data:l}=await t.from("RENT_leases").select("*").eq("tenant_id",a.id).order("lease_start_date",{ascending:!1}),i={...a,properties:r,leases:l||[]};return(0,n.ql)(i)}catch(e){return(0,n.ql)(null,(0,n.Iu)(e))}}static async create(e){try{let t=(0,n.Ng)(),{data:a,error:s}=await t.from("RENT_tenants").insert([e]).select("*").single();if(s)return(0,n.ql)(null,(0,n.Iu)(s));if(e.rent_cadence&&a.property_id){let s={tenant_id:a.id,property_id:a.property_id,lease_start_date:e.lease_start_date||new Date().toISOString(),lease_end_date:e.lease_end_date||new Date(Date.now()+31536e6).toISOString(),rent:e.monthly_rent||0,rent_cadence:e.rent_cadence,move_in_fee:0,late_fee_amount:50,status:"active"};await t.from("RENT_leases").insert([s])}let r=null;if(a.property_id){let{data:e}=await t.from("RENT_properties").select("id, name, address, notes, monthly_rent").eq("id",a.property_id).single();r=e}let{data:l}=await t.from("RENT_leases").select("*").eq("tenant_id",a.id).order("lease_start_date",{ascending:!1}),i={...a,properties:r,leases:l||[]};return(0,n.ql)(i)}catch(e){return(0,n.ql)(null,(0,n.Iu)(e))}}static async update(e,t){try{let a=(0,n.Ng)(),{data:s,error:r}=await a.from("RENT_tenants").update(t).eq("id",e).select("*").single();if(r)return(0,n.ql)(null,(0,n.Iu)(r));if(t.rent_cadence&&s.property_id){let{data:e}=await a.from("RENT_leases").select("id, lease_start_date, lease_end_date").eq("tenant_id",s.id).eq("status","active").single();if(e)await a.from("RENT_leases").update({rent_cadence:t.rent_cadence,rent:t.monthly_rent||0,lease_start_date:t.lease_start_date||e.lease_start_date,lease_end_date:t.lease_end_date||e.lease_end_date}).eq("id",e.id);else{let e={tenant_id:s.id,property_id:s.property_id,lease_start_date:t.lease_start_date||new Date().toISOString(),lease_end_date:t.lease_end_date||new Date(Date.now()+31536e6).toISOString(),rent:t.monthly_rent||0,rent_cadence:t.rent_cadence,move_in_fee:0,late_fee_amount:50,status:"active"};await a.from("RENT_leases").insert([e])}}let l=null;if(s.property_id){let{data:e}=await a.from("RENT_properties").select("id, name, address, notes, monthly_rent").eq("id",s.property_id).single();l=e}let{data:i}=await a.from("RENT_leases").select("*").eq("tenant_id",s.id).order("lease_start_date",{ascending:!1}),d={...s,properties:l,leases:i||[]};return(0,n.ql)(d)}catch(e){return(0,n.ql)(null,(0,n.Iu)(e))}}static async delete(e){try{let t=(0,n.Ng)(),{error:a}=await t.from("RENT_tenants").delete().eq("id",e);if(a)return(0,n.ql)(null,(0,n.Iu)(a));return(0,n.ql)(!0)}catch(e){return(0,n.ql)(null,(0,n.Iu)(e))}}static async getPaginated(e=1,t=10,a){try{let s=(0,n.Ng)(),r=(e-1)*t,l=s.from("RENT_tenants").select("*",{count:"exact"}).order("created_at",{ascending:!1}).range(r,r+t-1);a?.property_id&&(l=l.eq("property_id",a.property_id)),a?.is_active!==void 0&&(l=l.eq("is_active",a.is_active)),a?.late_status&&(l=l.eq("late_status",a.late_status));let{data:i,error:d,count:o}=await l;if(d)return(0,n.ql)(null,(0,n.Iu)(d));let c=await Promise.all(i.map(async e=>{let t=null;if(e.property_id){let{data:a}=await s.from("RENT_properties").select("id, name, address").eq("id",e.property_id).single();t=a}let{data:a}=await s.from("RENT_leases").select("*").eq("tenant_id",e.id).order("lease_start_date",{ascending:!1});return{...e,properties:t,leases:a||[]}}));return(0,n.ql)({data:c,total:o||0,page:e,limit:t,hasMore:r+t<(o||0)})}catch(e){return(0,n.ql)(null,(0,n.Iu)(e))}}static async search(e){try{let t=(0,n.Ng)(),{data:a,error:s}=await t.from("RENT_tenants").select("*").or(`first_name.ilike.%${e}%,last_name.ilike.%${e}%,email.ilike.%${e}%`).order("created_at",{ascending:!1});if(s)return(0,n.ql)(null,(0,n.Iu)(s));let r=await Promise.all(a.map(async e=>{let a=null;if(e.property_id){let{data:s}=await t.from("RENT_properties").select("id, name, address").eq("id",e.property_id).single();a=s}let{data:s}=await t.from("RENT_leases").select("*").eq("tenant_id",e.id).order("lease_start_date",{ascending:!1});return{...e,properties:a,leases:s||[]}}));return(0,n.ql)(r)}catch(e){return(0,n.ql)(null,(0,n.Iu)(e))}}static async getActive(){return this.getAll({is_active:!0})}static async getLate(){try{let e=(0,n.Ng)(),{data:t,error:a}=await e.from("RENT_tenants").select("*").neq("late_status","on_time").order("created_at",{ascending:!1});if(a)return(0,n.ql)(null,(0,n.Iu)(a));let s=await Promise.all(t.map(async t=>{let a=null;if(t.property_id){let{data:s}=await e.from("RENT_properties").select("id, name, address").eq("id",t.property_id).single();a=s}let{data:s}=await e.from("RENT_leases").select("*").eq("tenant_id",t.id).order("lease_start_date",{ascending:!1});return{...t,properties:a,leases:s||[]}}));return(0,n.ql)(s)}catch(e){return(0,n.ql)(null,(0,n.Iu)(e))}}static async getByProperty(e){return this.getAll({property_id:e})}static async recordPayment(e,t){try{let a=(0,n.Ng)(),{data:s,error:r}=await a.from("RENT_tenants").select("*").eq("id",e).single();if(r)return(0,n.ql)(null,(0,n.Iu)(r));if(!s)return(0,n.ql)(null,"Tenant not found");let l=null;if(s.property_id){let{data:e}=await a.from("RENT_properties").select("id, name, address, notes, monthly_rent").eq("id",s.property_id).single();l=e}let i=[...s.payment_history,{date:t.payment_date,amount:t.amount,status:"completed"}],d="on_time",o=0;if(l&&s.lease_start_date){let e={...s,payment_history:i},t=this.calculateTotalLatePayments(e,l);t.totalDue>0&&(o=t.totalLateFees,d=t.latePeriods>=3?"eviction_notice":t.latePeriods>=2?"late_10_days":"late_5_days")}let{data:c,error:u}=await a.from("RENT_tenants").update({payment_history:i,last_payment_date:t.payment_date,late_fees_owed:o,late_status:d}).eq("id",e).select("*, RENT_properties(name, address, notes, monthly_rent)").single();if(u)return(0,n.ql)(null,(0,n.Iu)(u));return(0,n.ql)(c)}catch(e){return(0,n.ql)(null,(0,n.Iu)(e))}}static async getLateTenants(){try{let e=(0,n.Ng)(),{data:t,error:a}=await e.from("RENT_tenants").select("*").eq("is_active",!0).order("created_at",{ascending:!1});if(a)return(0,n.ql)(null,(0,n.Iu)(a));let s=await Promise.all(t.map(async t=>{let a=null;if(t.property_id){let{data:s}=await e.from("RENT_properties").select("id, name, address, city, state, zip_code, property_type, monthly_rent, notes").eq("id",t.property_id).single();a=s}let{data:s}=await e.from("RENT_leases").select("id, lease_start_date, lease_end_date, rent, rent_cadence, status").eq("tenant_id",t.id).eq("status","active").order("lease_start_date",{ascending:!1}),{data:r}=await e.from("RENT_payments").select("id, amount, payment_date, payment_type").eq("tenant_id",t.id).order("payment_date",{ascending:!1});return{...t,properties:a,leases:s||[],actualPayments:r||[]}})),r=[];for(let e of s){if(!e.properties||!e.leases||0===e.leases.length)continue;let t=e.leases[0];if(!t.lease_start_date||!t.rent)continue;let a=new Date(t.lease_start_date),s=new Date;if(a>s||t.rent<=0)continue;let l=Math.floor((s.getTime()-a.getTime())/864e5);if(l<7||l>3650)continue;let n=t.rent_cadence||"monthly",i=0,d=30;switch(n.toLowerCase().trim()){case"weekly":i=Math.ceil(l/7),d=7;break;case"bi-weekly":case"biweekly":case"bi_weekly":i=Math.ceil(l/14),d=14;break;default:i=Math.ceil(l/30),d=30}let o=t.rent*i,c=(e.actualPayments||[]).reduce((e,t)=>e+t.amount,0),u=!1,m=0,p=0,y=0;if(c<o){u=!0,m=o-c;let e=t.rent;if(p=Math.ceil(m/e),i>0){let e=new Date(a);e.setDate(e.getDate()+d*(i-1));let t=new Date(e);t.setDate(t.getDate()+5),s>t?y=Math.floor((s.getTime()-t.getTime())/864e5):(y=Math.floor((s.getTime()-e.getTime())/864e5))<0&&(y=0)}}else{let r=(e.actualPayments||[]).sort((e,t)=>new Date(e.payment_date).getTime()-new Date(t.payment_date).getTime());if(r.length>0){let e=r[r.length-1],l=new Date(e.payment_date),n=new Date(a);n.setDate(n.getDate()+d*(i-1));let o=new Date(n);o.setDate(o.getDate()+5),l>o&&(u=!0,m=t.rent,p=1,y=Math.floor((s.getTime()-o.getTime())/864e5))}}if(u){let t=0;switch(n.toLowerCase().trim()){case"weekly":t=10;break;case"bi-weekly":case"biweekly":case"bi_weekly":t=20;break;default:t=50}let a=t*p,s={...e,properties:e.properties,total_due:m,total_late_fees:a,total_outstanding:m,late_periods:p,days_late:Math.max(0,y)};r.push(s)}}return(0,n.ql)(r)}catch(e){return(0,n.ql)(null,(0,n.Iu)(e))}}static calculateTotalDue(e){return e.properties?this.calculateTotalLatePayments(e,e.properties).totalDue:(e.monthly_rent||0)+(e.late_fees_owed||0)}static calculateDaysLate(e){if(!e)return 0;let t=new Date(e);return Math.ceil(Math.abs(new Date().getTime()-t.getTime())/864e5)}static calculateLatePeriods(e,t){if(!e.leases||0===e.leases.length)return 0;switch((e.leases[0].rent_cadence||"monthly").toLowerCase().trim()){case"weekly":return Math.ceil(t/7);case"bi-weekly":case"biweekly":case"bi_weekly":return Math.ceil(t/14);default:return Math.ceil(t/30)}}static calculateLateFees(e,t){if(!e.leases||0===e.leases.length)return 0;let a=(e.leases[0].rent_cadence||"monthly").toLowerCase().trim(),s=0;switch(a){case"weekly":s=10;break;case"bi-weekly":case"biweekly":case"bi_weekly":s=20;break;default:s=50}return t*s}static calculateTotalDueWithLateFees(e,t){return(e.leases&&e.leases.length>0?e.leases[0].rent:e.monthly_rent||0)+t}static calculateTenantOwedAmount(e){if(!e.leases||0===e.leases.length)return{totalOwed:0,totalLateFees:0,missedPeriods:0,missedPayments:[]};let t=e.leases[0],a=t.rent||e.monthly_rent||0,s=t.rent_cadence||"monthly",r=new Date(e.currently_paid_up_date?e.currently_paid_up_date:e.last_payment_date?e.last_payment_date:t.lease_start_date),l=new Date,n=new Date(r),i=0,d=0,o=0,c=[];for(;n<=l;){let e=new Date(n),t=Math.floor((l.getTime()-e.getTime())/864e5)>5,r=t?this.getLateFeeAmount(s):0;switch(i+=a+r,d+=r,o++,c.push({dueDate:e,amount:a,isLate:t,lateFee:r}),s.toLowerCase().trim()){case"weekly":n.setDate(n.getDate()+7);break;case"bi-weekly":case"biweekly":case"bi_weekly":n.setDate(n.getDate()+14);break;default:n.setMonth(n.getMonth()+1)}}return{totalOwed:i,totalLateFees:d,missedPeriods:o,missedPayments:c}}static calculateDaysLateFromPaidUpDate(e){if(!e.leases||0===e.leases.length)return 0;let t=e.leases[0],a=t.rent_cadence||"monthly",s=new Date(e.currently_paid_up_date?e.currently_paid_up_date:e.last_payment_date?e.last_payment_date:t.lease_start_date),r=new Date,l=new Date(s),n=0;for(;l<=r;){let e=new Date(l),t=Math.floor((r.getTime()-e.getTime())/864e5);switch(t>5&&(n+=t-5),a.toLowerCase().trim()){case"weekly":l.setDate(l.getDate()+7);break;case"bi-weekly":case"biweekly":case"bi_weekly":l.setDate(l.getDate()+14);break;default:l.setMonth(l.getMonth()+1)}}return n}static getLateFeeAmount(e){switch(e.toLowerCase().trim()){case"weekly":return 10;case"bi-weekly":case"biweekly":case"bi_weekly":return 20;default:return 45}}static extractRentCadence(e){if(!e)return"monthly";let t=e.match(/Rent cadence:\s*(\w+)/i);return t?t[1]:"monthly"}static daysBetween(e,t){let a=new Date(e);return Math.ceil(Math.abs(new Date(t).getTime()-a.getTime())/864e5)}static getExpectedPaymentDate(e,t,a){let s=new Date(e);switch(a.toLowerCase().trim()){case"weekly":return new Date(s.getTime()+6048e5*t);case"bi-weekly":case"biweekly":case"bi_weekly":return new Date(s.getTime()+12096e5*t);default:let r=new Date(s);return r.setMonth(r.getMonth()+t),r}}static getLastExpectedPaymentDates(e,t,a=12){let s=[],r=new Date,l=0,n=this.getExpectedPaymentDate(e,l,t);for(;n<=r&&l<2*a;)l++,n=this.getExpectedPaymentDate(e,l,t);for(let r=Math.max(0,l-a);r<l;r++)s.push(this.getExpectedPaymentDate(e,r,t));return s}static calculateLateFeesForPeriod(e,t,a,s){let r=this.getLateFeeAmount(a),l=new Date(e);l.setDate(l.getDate()-2);let n=new Date(e);n.setDate(n.getDate()+5);let i=t.filter(e=>{let t=new Date(e.date);return t>=l&&t<=n&&"completed"===e.status}),d=i.reduce((e,t)=>e+t.amount,0),o=Math.max(0,s-d),c=i.length>0?new Date(Math.max(...i.map(e=>new Date(e.date).getTime()))):null;return!c||c>n?{isLate:!0,daysLate:Math.max(0,c?this.daysBetween(n,c):this.daysBetween(n,new Date)),lateFees:o>0?r:0,totalPaid:d,outstanding:o}:{isLate:!1,daysLate:0,lateFees:0,totalPaid:d,outstanding:o}}static calculateTotalLatePayments(e,t){if(!e.leases||0===e.leases.length)return{totalLateFees:0,totalOutstanding:0,totalDue:0,latePeriods:0,payPeriods:[]};let a=e.leases[0];if(!a.lease_start_date||!a.rent)return{totalLateFees:0,totalOutstanding:0,totalDue:0,latePeriods:0,payPeriods:[]};let s=a.rent_cadence||"monthly",r=a.rent,l=this.getLastExpectedPaymentDates(a.lease_start_date,s,12),n=0,i=0,d=0,o=l.map(t=>{let a=this.calculateLateFeesForPeriod(t,e.payment_history||[],s,r);return a.isLate&&(n+=a.lateFees,i+=a.outstanding,d++),{expectedDate:t,...a}});return{totalLateFees:n,totalOutstanding:i,totalDue:n+i,latePeriods:d,payPeriods:o}}static isTenantLate(e,t){return this.calculateTotalLatePayments(e,t).totalDue>0}static async createByPropertyAddress(e){try{let t=(0,n.Ng)(),{data:a,error:s}=await t.from("RENT_properties").select("id, monthly_rent").ilike("address",`%${e.property_address}%`).single();if(s)return(0,n.ql)(null,`Property not found with address: ${e.property_address}`);let{property_address:r,...l}=e,i={...l,property_id:a.id,monthly_rent:e.monthly_rent||a.monthly_rent},{data:d,error:o}=await t.from("RENT_tenants").insert([i]).select("*, RENT_properties(name, address)").single();if(o)return(0,n.ql)(null,(0,n.Iu)(o));return(0,n.ql)(d)}catch(e){return(0,n.ql)(null,(0,n.Iu)(e))}}static async bulkCreateByPropertyAddress(e){try{(0,n.Ng)();let t=[],a=[];for(let s of e)try{let e=await this.createByPropertyAddress(s);e.success&&e.data?t.push(e.data):a.push(`Failed to create tenant ${s.first_name} ${s.last_name}: ${e.error}`)}catch(e){a.push(`Error creating tenant ${s.first_name} ${s.last_name}: ${e}`)}return(0,n.ql)({created:t,errors:a})}catch(e){return(0,n.ql)(null,(0,n.Iu)(e))}}}class d{static async getAll(){try{let e=(0,n.Ng)(),{data:t,error:a}=await e.from("RENT_leases").select("*").order("lease_start_date",{ascending:!1});if(a)return(0,n.ql)(null,(0,n.Iu)(a));return(0,n.ql)(t)}catch(e){return(0,n.ql)(null,(0,n.Iu)(e))}}static async getByPropertyId(e){try{let t=(0,n.Ng)(),{data:a,error:s}=await t.from("RENT_leases").select("*").eq("property_id",e).order("lease_start_date",{ascending:!1});if(s)return(0,n.ql)(null,(0,n.Iu)(s));return(0,n.ql)(a)}catch(e){return(0,n.ql)(null,(0,n.Iu)(e))}}static async getActiveLeasesByPropertyId(e){try{let t=(0,n.Ng)(),a=new Date().toISOString().split("T")[0],{data:s,error:r}=await t.from("RENT_leases").select("*").eq("property_id",e).lte("lease_start_date",a).gte("lease_end_date",a).order("lease_start_date",{ascending:!1});if(r)return(0,n.ql)(null,(0,n.Iu)(r));return(0,n.ql)(s)}catch(e){return(0,n.ql)(null,(0,n.Iu)(e))}}static async hasActiveLeases(e){try{let t=await this.getActiveLeasesByPropertyId(e);if(!t.success)return(0,n.ql)(!1);let a=t.data&&t.data.length>0;return(0,n.ql)(a)}catch(e){return(0,n.ql)(!1)}}static async create(e){try{let t=(0,n.Ng)(),{data:a,error:s}=await t.from("RENT_leases").insert([e]).select().single();if(s)return(0,n.ql)(null,(0,n.Iu)(s));return(0,n.ql)(a)}catch(e){return(0,n.ql)(null,(0,n.Iu)(e))}}static async update(e,t){try{let a=(0,n.Ng)(),{data:s,error:r}=await a.from("RENT_leases").update(t).eq("id",e).select().single();if(r)return(0,n.ql)(null,(0,n.Iu)(r));return(0,n.ql)(s)}catch(e){return(0,n.ql)(null,(0,n.Iu)(e))}}static async delete(e){try{let t=(0,n.Ng)(),{error:a}=await t.from("RENT_leases").delete().eq("id",e);if(a)return(0,n.ql)(null,(0,n.Iu)(a));return(0,n.ql)(!0)}catch(e){return(0,n.ql)(null,(0,n.Iu)(e))}}static async updateLeaseStatus(e){try{let t=(0,n.Ng)(),a=new Date().toISOString().split("T")[0],{data:s,error:r}=await t.from("RENT_leases").select("*").eq("id",e).single();if(r)return(0,n.ql)(null,(0,n.Iu)(r));let l="active";if(a<s.lease_start_date?l="pending":a>s.lease_end_date&&(l="expired"),s.status!==l)return await this.update(e,{status:l});return(0,n.ql)(s)}catch(e){return(0,n.ql)(null,(0,n.Iu)(e))}}static async getAllPropertiesWithLeaseStatus(){try{let e=(0,n.Ng)(),{data:t,error:a}=await e.from("RENT_leases").select("*").eq("status","active");if(a)return(0,n.ql)(null,(0,n.Iu)(a));let s=new Map;(t||[]).forEach(e=>{s.has(e.property_id)||s.set(e.property_id,[]),s.get(e.property_id).push(e)});let{data:r,error:l}=await e.from("RENT_properties").select("id");if(l)return(0,n.ql)(null,(0,n.Iu)(l));let i=(r||[]).map(e=>{let t=s.get(e.id)||[];return{property_id:e.id,has_active_lease:t.length>0,active_lease_count:t.length,active_leases:t}});return(0,n.ql)(i)}catch(e){return(0,n.ql)(null,(0,n.Iu)(e))}}}class o{static async getAll(e){try{let t=(0,n.Ng)().from("RENT_properties").select(`
          id,
          name,
          address,
          city,
          state,
          zip_code,
          property_type,
          status,
          bedrooms,
          bathrooms,
          square_feet,
          year_built,
          purchase_price,
          purchase_payment,
          purchase_date,
          current_value,
          monthly_rent,
          is_for_rent,
          is_for_sale,
          insurance_premium,
          property_tax,
          notes,
          created_at,
          updated_at
        `).order("created_at",{ascending:!1});e?.is_for_rent!==void 0&&(t=t.eq("is_for_rent",e.is_for_rent)),e?.is_for_sale!==void 0&&(t=t.eq("is_for_sale",e.is_for_sale)),e?.city&&(t=t.eq("city",e.city)),e?.state&&(t=t.eq("state",e.state));let{data:a,error:s}=await t;if(s)return console.error("PropertiesService.getAll error:",s),(0,n.ql)(null,(0,n.Iu)(s));let r=await d.getAllPropertiesWithLeaseStatus();if(!r.success||!r.data)return(0,n.ql)(a);let l=new Map(r.data.map(e=>[e.property_id,e])),i=a.map(e=>{let t=l.get(e.id),a=t?.has_active_lease||!1;return{...e,status:a?"rented":"empty",active_leases:t?.active_leases||[],active_lease_count:t?.active_lease_count||0}});return(0,n.ql)(i)}catch(e){return console.error("PropertiesService.getAll exception:",e),(0,n.ql)(null,(0,n.Iu)(e))}}static async getById(e){try{let t=(0,n.Ng)(),{data:a,error:s}=await t.from("RENT_properties").select("*").eq("id",e).single();if(s)return(0,n.ql)(null,(0,n.Iu)(s));let{data:r}=await t.from("RENT_tenants").select("*").eq("property_id",e).eq("is_active",!0),l={...a,tenants:r||[]};return(0,n.ql)(l)}catch(e){return(0,n.ql)(null,(0,n.Iu)(e))}}static async create(e){try{let t=(0,n.Ng)(),{data:a,error:s}=await t.from("RENT_properties").insert([e]).select().single();if(s)return(0,n.ql)(null,(0,n.Iu)(s));return(0,n.ql)(a)}catch(e){return(0,n.ql)(null,(0,n.Iu)(e))}}static async update(e,t){try{let a=(0,n.Ng)(),{data:s,error:r}=await a.from("RENT_properties").update(t).eq("id",e).select().single();if(r)return(0,n.ql)(null,(0,n.Iu)(r));return(0,n.ql)(s)}catch(e){return(0,n.ql)(null,(0,n.Iu)(e))}}static async delete(e){try{let t=(0,n.Ng)(),{error:a}=await t.from("RENT_properties").delete().eq("id",e);if(a)return(0,n.ql)(null,(0,n.Iu)(a));return(0,n.ql)(!0)}catch(e){return(0,n.ql)(null,(0,n.Iu)(e))}}static async getPaginated(e=1,t=10,a){try{let s=(0,n.Ng)(),r=(e-1)*t,l=s.from("RENT_properties").select("*",{count:"exact"}).order("created_at",{ascending:!1}).range(r,r+t-1);a?.is_for_rent!==void 0&&(l=l.eq("is_for_rent",a.is_for_rent)),a?.is_for_sale!==void 0&&(l=l.eq("is_for_sale",a.is_for_sale)),a?.city&&(l=l.eq("city",a.city)),a?.state&&(l=l.eq("state",a.state));let{data:i,error:d,count:o}=await l;if(d)return(0,n.ql)(null,(0,n.Iu)(d));let c=await Promise.all(i.map(async e=>{let{data:t}=await s.from("RENT_tenants").select("*").eq("property_id",e.id);return{...e,tenants:t||[]}})),u=o||0;return(0,n.ql)({data:c,total:u,page:e,limit:t,hasMore:r+t<u})}catch(e){return(0,n.ql)(null,(0,n.Iu)(e))}}static async search(e){try{let t=(0,n.Ng)(),{data:a,error:s}=await t.from("RENT_properties").select("*").or(`name.ilike.%${e}%,address.ilike.%${e}%,city.ilike.%${e}%`).order("created_at",{ascending:!1});if(s)return(0,n.ql)(null,(0,n.Iu)(s));let r=await Promise.all(a.map(async e=>{let{data:a}=await t.from("RENT_tenants").select("*").eq("property_id",e.id);return{...e,tenants:a||[]}}));return(0,n.ql)(r)}catch(e){return(0,n.ql)(null,(0,n.Iu)(e))}}static async getAvailableForRent(){return this.getAll({is_for_rent:!0})}static async getAvailableForSale(){return this.getAll({is_for_sale:!0})}}var c=a(8969);function u({tenant:e,onClose:t,onSave:a}){let[l,n]=(0,r.useState)([]),[i,d]=(0,r.useState)(!0),o=(e,t)=>{let a=[...l];a[e].editedLateFees=Math.max(0,t),n(a)},c=(e,t)=>{let a=[...l];a[e].editedPaymentDate=t,n(a)},u=(e,t)=>{let a=[...l];a[e].editedPaymentAmount=Math.max(0,t),n(a)},m=()=>l.reduce((e,t)=>{let a=t.editedLateFees||t.lateFees,s=t.editedPaymentAmount||0;return e+a+Math.max(0,t.outstanding-s)},0);return i?s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:s.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary-600"})}):s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-6xl w-full max-h-[90vh] overflow-hidden",children:[(0,s.jsxs)("div",{className:"px-6 py-4 border-b border-gray-200 flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("h2",{className:"text-xl font-semibold text-gray-900",children:["Late Payment Details - ",e.first_name," ",e.last_name]}),s.jsx("p",{className:"text-sm text-gray-600",children:e.property_address})]}),s.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 text-2xl font-bold",children:"\xd7"})]}),(0,s.jsxs)("div",{className:"px-6 py-4 overflow-y-auto max-h-[calc(90vh-200px)]",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[(0,s.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[s.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Monthly Rent"}),(0,s.jsxs)("p",{className:"text-lg font-semibold text-gray-900",children:["$",e.rent.toLocaleString()]})]}),(0,s.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[s.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Current Total Owed"}),(0,s.jsxs)("p",{className:"text-lg font-semibold text-red-600",children:["$",e.total_owed.toLocaleString()]})]}),(0,s.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[s.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Updated Total"}),(0,s.jsxs)("p",{className:"text-lg font-semibold text-blue-600",children:["$",m().toLocaleString()]})]}),(0,s.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[s.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Late Periods"}),s.jsx("p",{className:"text-lg font-semibold text-gray-900",children:e.late_periods})]})]}),(0,s.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden",children:[(0,s.jsxs)("div",{className:"px-4 py-3 bg-gray-50 border-b border-gray-200",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Payment Periods"}),s.jsx("p",{className:"text-sm text-gray-600",children:"Edit late fees and record payments for each period"})]}),s.jsx("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[s.jsx("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Expected Date"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Days Late"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Late Fees"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Outstanding"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Payment Date"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Payment Amount"}),s.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"New Outstanding"})]})}),s.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:l.map((e,t)=>(0,s.jsxs)("tr",{className:e.isLate?"bg-red-50":"bg-green-50",children:[s.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900",children:e.expectedDate.toLocaleDateString()}),s.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900",children:e.daysLate}),s.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:s.jsx("input",{type:"number",min:"0",step:"0.01",value:e.editedLateFees||e.lateFees,onChange:e=>o(t,parseFloat(e.target.value)||0),className:"w-20 px-2 py-1 border border-gray-300 rounded text-sm"})}),(0,s.jsxs)("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-gray-900",children:["$",e.outstanding.toLocaleString()]}),s.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:s.jsx("input",{type:"date",value:e.editedPaymentDate||"",onChange:e=>c(t,e.target.value),className:"px-2 py-1 border border-gray-300 rounded text-sm"})}),s.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:s.jsx("input",{type:"number",min:"0",step:"0.01",value:e.editedPaymentAmount||0,onChange:e=>u(t,parseFloat(e.target.value)||0),className:"w-24 px-2 py-1 border border-gray-300 rounded text-sm"})}),(0,s.jsxs)("td",{className:"px-4 py-3 whitespace-nowrap text-sm font-semibold",children:["$",Math.max(0,e.outstanding-(e.editedPaymentAmount||0)).toLocaleString()]})]},t))})]})})]}),(0,s.jsxs)("div",{className:"mt-6 bg-blue-50 p-4 rounded-lg",children:[s.jsx("h3",{className:"text-lg font-medium text-blue-900 mb-2",children:"Summary of Changes"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[(0,s.jsxs)("div",{children:[s.jsx("span",{className:"text-blue-700",children:"Original Total:"}),(0,s.jsxs)("span",{className:"ml-2 font-semibold",children:["$",e.total_owed.toLocaleString()]})]}),(0,s.jsxs)("div",{children:[s.jsx("span",{className:"text-blue-700",children:"Updated Total:"}),(0,s.jsxs)("span",{className:"ml-2 font-semibold",children:["$",m().toLocaleString()]})]}),(0,s.jsxs)("div",{children:[s.jsx("span",{className:"text-blue-700",children:"Difference:"}),(0,s.jsxs)("span",{className:`ml-2 font-semibold ${m()<e.total_owed?"text-green-600":"text-red-600"}`,children:["$",(m()-e.total_owed).toLocaleString()]})]})]})]})]}),(0,s.jsxs)("div",{className:"px-6 py-4 border-t border-gray-200 flex justify-end space-x-3",children:[s.jsx("button",{onClick:t,className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors",children:"Cancel"}),s.jsx("button",{onClick:()=>{a({tenantId:e.id,paymentPeriods:l.map(e=>({expectedDate:e.expectedDate,originalLateFees:e.lateFees,updatedLateFees:e.editedLateFees,originalOutstanding:e.outstanding,paymentDate:e.editedPaymentDate,paymentAmount:e.editedPaymentAmount,newOutstanding:Math.max(0,e.outstanding-(e.editedPaymentAmount||0))})),totalUpdated:m()})},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Save Changes"})]})]})})}function m(){let e=(0,l.useRouter)(),[t,a]=(0,r.useState)([]),[n,d]=(0,r.useState)(!0),[m,p]=(0,r.useState)(null),[y,h]=(0,r.useState)(!1),x=async()=>{try{d(!0);let e=(await i.getAll()).data,t=(await o.getAll()).data;if(!e||!t){console.error("Failed to load data");return}let s=[];e.forEach(e=>{try{let a=t.find(t=>t.id===e.property_id);if(!a)return;let r=e.leases&&e.leases.length>0?e.leases[0]:null;if(!r||!r.lease_start_date)return;let l={...e,lease_start_date:r.lease_start_date},n={...a,notes:a.notes||""};if((0,c.mq)(l,n)){let t=(0,c.c1)(l,n);s.push({id:e.id,first_name:e.first_name,last_name:e.last_name,property_id:e.property_id,property_name:a.name,property_address:a.address,rent:a.monthly_rent||0,total_owed:t.totalDue,late_periods:t.latePeriods,lease_start_date:r.lease_start_date,rent_cadence:r.rent_cadence||"monthly",late_payment_info:t})}}catch(t){console.error("Error processing tenant:",e.first_name,e.last_name,t)}}),s.sort((e,t)=>{let a=e=>{switch(e.toLowerCase().trim()){case"weekly":return 1;case"bi-weekly":case"biweekly":case"bi_weekly":return 2;default:return 3}},s=a(e.rent_cadence),r=a(t.rent_cadence);return s!==r?s-r:t.total_owed-e.total_owed}),a(s)}catch(e){console.error("Error loading late payments:",e)}finally{d(!1)}},_=e=>{p(e),h(!0)},g=()=>{h(!1),p(null)},f=async e=>{await x(),g()};return n?s.jsx("div",{className:"min-h-screen flex items-center justify-center",children:s.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary-600"})}):(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[s.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200",children:s.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,s.jsxs)("div",{className:"flex justify-between items-center py-6",children:[(0,s.jsxs)("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Late Payments"}),s.jsx("p",{className:"text-gray-600",children:"Manage tenants with outstanding balances"})]}),s.jsx("div",{className:"flex items-center space-x-4",children:s.jsx("button",{onClick:()=>e.push("/"),className:"bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors",children:"Back to Dashboard"})})]})})}),(0,s.jsxs)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Total Late Tenants"}),s.jsx("p",{className:"text-3xl font-bold text-red-600",children:t.length})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Total Outstanding"}),(0,s.jsxs)("p",{className:"text-3xl font-bold text-red-600",children:["$",t.reduce((e,t)=>e+t.total_owed,0).toLocaleString()]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Average Per Tenant"}),(0,s.jsxs)("p",{className:"text-3xl font-bold text-red-600",children:["$",t.length>0?(t.reduce((e,t)=>e+t.total_owed,0)/t.length).toFixed(0):0]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[s.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Total Late Periods"}),s.jsx("p",{className:"text-3xl font-bold text-red-600",children:t.reduce((e,t)=>e+t.late_periods,0)})]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[(0,s.jsxs)("div",{className:"px-6 py-4 border-b border-gray-200",children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Late Payment Details"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Sorted by payment cadence: Weekly (1) → Bi-weekly (2) → Monthly (3), then by total amount owed"})]}),s.jsx("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[s.jsx("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tenant"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Property Address"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Rent Cadence"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Rent"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total Owed"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Late Periods"}),s.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),s.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(e=>(0,s.jsxs)("tr",{className:"hover:bg-gray-50",children:[s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,s.jsxs)("div",{className:"text-sm font-medium text-gray-900",children:[e.first_name," ",e.last_name]})}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.jsx("div",{className:"text-sm text-gray-900",children:e.property_address})}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[s.jsx("span",{className:"text-sm text-gray-600 capitalize",children:e.rent_cadence}),s.jsx("span",{className:`inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium ${"weekly"===e.rent_cadence.toLowerCase()?"bg-red-100 text-red-800":"bi-weekly"===e.rent_cadence.toLowerCase()||"biweekly"===e.rent_cadence.toLowerCase()||"bi_weekly"===e.rent_cadence.toLowerCase()?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"}`,children:"weekly"===e.rent_cadence.toLowerCase()?"1":"bi-weekly"===e.rent_cadence.toLowerCase()||"biweekly"===e.rent_cadence.toLowerCase()||"bi_weekly"===e.rent_cadence.toLowerCase()?"2":"3"})]})}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,s.jsxs)("div",{className:"text-sm text-gray-900",children:["$",e.rent.toLocaleString()]})}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,s.jsxs)("div",{className:"text-sm font-semibold text-red-600",children:["$",e.total_owed.toLocaleString()]})}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:s.jsx("div",{className:"text-sm text-gray-900",children:e.late_periods})}),s.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:s.jsx("button",{onClick:()=>_(e),className:"text-indigo-600 hover:text-indigo-900 bg-indigo-100 hover:bg-indigo-200 px-3 py-1 rounded-md transition-colors",children:"Details"})})]},e.id))})]})}),0===t.length&&s.jsx("div",{className:"text-center py-12",children:s.jsx("p",{className:"text-gray-500 text-lg",children:"No late payments found"})})]})]}),y&&m&&s.jsx(u,{tenant:m,onClose:g,onSave:f})]})}},8130:(e,t,a)=>{"use strict";a.d(t,{Header:()=>h});var s=a(3227),r=a(3677),l=a(1043),n=a(3239),i=a(1692),d=a(401),o=a(582),c=a(3540),u=a(426),m=a(5368),p=a(7587);function y({className:e="w-8 h-8"}){return(0,s.jsxs)("svg",{viewBox:"0 0 120 60",className:e,fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[s.jsx("path",{d:"M10 20 L30 10 L50 20 L70 10 L90 20 L110 10 L110 25 L10 25 Z",fill:"#dc2626",stroke:"#991b1b",strokeWidth:"1"}),s.jsx("rect",{x:"55",y:"5",width:"8",height:"15",fill:"#374151"}),s.jsx("rect",{x:"15",y:"27",width:"8",height:"6",fill:"#374151"}),s.jsx("rect",{x:"55",y:"27",width:"8",height:"6",fill:"#374151"}),s.jsx("rect",{x:"95",y:"27",width:"8",height:"6",fill:"#374151"}),s.jsx("text",{x:"60",y:"50",textAnchor:"middle",fill:"#374151",fontSize:"8",fontFamily:"Arial, sans-serif",fontWeight:"bold",children:"Honest Home Sales"})]})}function h(){let[e,t]=(0,r.useState)(!1),a=(0,l.useRouter)(),h=[{label:"Dashboard",icon:s.jsx(n.Z,{className:"w-5 h-5 mr-2"}),href:"/"},{label:"Properties",icon:s.jsx(i.Z,{className:"w-5 h-5 mr-2"}),href:"/properties"},{label:"Tenants",icon:s.jsx(d.Z,{className:"w-5 h-5 mr-2"}),href:"/tenants"},{label:"Payments",icon:s.jsx(o.Z,{className:"w-5 h-5 mr-2"}),href:"/payments"},{label:"Late Tenants",icon:s.jsx(c.Z,{className:"w-5 h-5 mr-2"}),href:"/late-tenants"},{label:"Profit",icon:s.jsx(u.Z,{className:"w-5 h-5 mr-2"}),href:"/profit"}];return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("header",{className:"w-full bg-white shadow-sm border-b border-gray-200 flex items-center h-16 px-4 z-50 sticky top-0",children:[s.jsx("button",{className:"text-gray-700 hover:text-primary-600 focus:outline-none mr-4",onClick:()=>t(!0),"aria-label":"Open menu",children:s.jsx(m.Z,{className:"w-7 h-7"})}),s.jsx("span",{className:"text-xl font-bold text-gray-900",children:"Rental Management App"}),s.jsx("div",{className:"ml-4 flex items-center",children:s.jsx(y,{className:"w-8 h-8"})})]}),s.jsx("div",{className:`fixed inset-0 z-[9999] transition-all duration-300 ${e?"visible":"invisible pointer-events-none"}`,style:{background:e?"rgba(0,0,0,0.3)":"transparent"},onClick:()=>t(!1),children:(0,s.jsxs)("nav",{className:`fixed top-0 left-0 h-full w-72 bg-white shadow-xl transform transition-transform duration-300 z-[10000] ${e?"translate-x-0":"-translate-x-full"}`,onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[s.jsx("span",{className:"text-lg font-bold text-gray-900 mr-3",children:"Menu"}),s.jsx(y,{className:"w-6 h-6"})]}),s.jsx("button",{className:"text-gray-500 hover:text-primary-600 focus:outline-none",onClick:()=>t(!1),"aria-label":"Close menu",children:s.jsx(p.Z,{className:"w-6 h-6"})})]}),s.jsx("ul",{className:"py-4",children:h.map(e=>s.jsx("li",{children:(0,s.jsxs)("button",{className:"w-full flex items-center px-6 py-3 text-gray-700 hover:bg-primary-50 hover:text-primary-700 text-base font-medium transition-colors",onClick:()=>{t(!1),a.push(e.href)},children:[e.icon,e.label]})},e.href))})]})})]})}},8969:(e,t,a)=>{"use strict";function s(e,t){if(!e||!t)return e||0;switch(t.toLowerCase().trim()){case"weekly":return 4.33*e;case"bi-weekly":case"biweekly":case"bi_weekly":return 2.17*e;default:return e}}function r(e){if(!e)return"monthly";let t=e.match(/Rent cadence:\s*(\w+)/i);return t?t[1]:"monthly"}function l(e,t){if(!e)return"$0";let a=t?.toLowerCase().trim()||"monthly";return`$${e.toLocaleString()}/${a}`}function n(e,t,a){let s;let r=new Date(e);switch(a.toLowerCase().trim()){case"weekly":s=new Date(r.getTime()+6048e5*t);break;case"bi-weekly":case"biweekly":case"bi_weekly":s=new Date(r.getTime()+12096e5*t);break;default:(s=new Date(r)).setMonth(s.getMonth()+t)}return s}function i(e,t){if(console.log("calculateTotalLatePayments: Starting calculation for",e.first_name,e.last_name),!e||!t||!e.lease_start_date||!t?.monthly_rent)return console.log("calculateTotalLatePayments: Missing required data - tenant:",!!e,"property:",!!t,"lease_start_date:",e?.lease_start_date,"monthly_rent:",t?.monthly_rent),{totalLateFees:0,totalOutstanding:0,totalDue:0,latePeriods:0,payPeriods:[]};try{let a=r(t.notes),s=t.monthly_rent;console.log("calculateTotalLatePayments: Cadence:",a,"Monthly rent:",s);let l=s;"weekly"===a?l=s/4.33:("bi-weekly"===a||"biweekly"===a||"bi_weekly"===a)&&(l=s/2.17),console.log("Tenant calculation - Cadence:",a,"Monthly rent:",s,"Period rent:",l);let i=function(e,t,a=12){let s=[],r=new Date,l=0,i=n(e,0,t),d=0,o=3*a;for(;i<=r&&l<2*a&&d<o;)i=n(e,++l,t),d++;if(d>=o)return console.error("getLastExpectedPaymentDates: Safety limit reached, possible infinite loop detected"),[];l=Math.max(0,l-1);for(let i=Math.max(0,l-a+1);i<=l;i++){let a=n(e,i,t);a<=r&&s.push(a)}return s}(e.lease_start_date,a,12),d=0,o=0,c=0,u=i.map(t=>{let s=function(e,t,a,s){let r=function(e){switch(e.toLowerCase().trim()){case"weekly":return 10;case"bi-weekly":case"biweekly":case"bi_weekly":return 20;default:return 45}}(a),l=e.toISOString().split("T")[0];t&&Array.isArray(t)||(t=[]);let n=new Date(e);n.setDate(n.getDate()-2);let i=new Date(e);i.setDate(i.getDate()+5);let d=t.filter(e=>{let t=new Date(e.date);return t>=n&&t<=i&&"completed"===e.status}),o=d.reduce((e,t)=>e+t.amount,0),c=Math.max(0,s-o),u=new Date,m=0===d.length&&u>i;return(m&&console.log("LATE PERIOD:",{expectedDate:l,periodEnd:i.toISOString().split("T")[0],today:u.toISOString().split("T")[0],outstanding:c,lateFee:c>0?r:0}),m)?{isLate:!0,daysLate:Math.max(0,function(e,t){let a=new Date(e);return Math.ceil(Math.abs(new Date(t).getTime()-a.getTime())/864e5)}(i,u)),lateFees:c>0?r:0,totalPaid:o,outstanding:c}:{isLate:!1,daysLate:0,lateFees:0,totalPaid:o,outstanding:c}}(t,e.payment_history,a,l);return s.isLate&&(d+=s.lateFees,o+=s.outstanding,c++),{expectedDate:t,...s}}),m={totalLateFees:d,totalOutstanding:o,totalDue:d+o,latePeriods:c,payPeriods:u};return console.log("calculateTotalLatePayments: Final result for",e.first_name,e.last_name,":",m),m}catch(e){return console.error("Error calculating late payments:",e),{totalLateFees:0,totalOutstanding:0,totalDue:0,latePeriods:0,payPeriods:[]}}}function d(e,t){try{if(!e||!t)return console.log("isTenantLate: Missing tenant or property data"),!1;console.log("isTenantLate: Starting check for tenant",e.first_name,e.last_name),console.log("isTenantLate: Tenant lease_start_date:",e.lease_start_date),console.log("isTenantLate: Property monthly_rent:",t.monthly_rent);let a=i(e,t),s=a.totalDue>0;return console.log("isTenantLate: Result - Total due:",a.totalDue,"Is late:",s),s}catch(e){return console.error("Error checking if tenant is late:",e),!1}}a.d(t,{GN:()=>s,S6:()=>r,c1:()=>i,eP:()=>l,mq:()=>d})},3726:(e,t,a)=>{"use strict";function s(){throw Error("Supabase client cannot be used on the server side")}function r(e){return e?.message?e.message:e?.error_description?e.error_description:"An unexpected error occurred"}function l(e,t=null){return{data:e,error:t,success:!t}}a.d(t,{Iu:()=>r,Ng:()=>s,ql:()=>l}),a(8891)},6070:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>s});let s=(0,a(3189).createProxy)(String.raw`C:\Projects\Rental_App\apps\web\app\late-payments\page.tsx#default`)},7195:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>o,metadata:()=>d});var s=a(9013),r=a(8747),l=a.n(r);a(1);let n=(0,a(3189).createProxy)(String.raw`C:\Projects\Rental_App\apps\web\components\Header.tsx#Header`);var i=a(2281);let d={title:"Rental Management App",description:"Comprehensive rental property management system"};function o({children:e}){return s.jsx("html",{lang:"en",children:(0,s.jsxs)("body",{className:l().className,children:[(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[s.jsx(n,{}),s.jsx("main",{className:"container mx-auto px-4 py-8",children:e})]}),s.jsx(i.x7,{position:"top-right",toastOptions:{duration:4e3,style:{background:"#363636",color:"#fff"},success:{duration:3e3,iconTheme:{primary:"#22c55e",secondary:"#fff"}},error:{duration:5e3,iconTheme:{primary:"#ef4444",secondary:"#fff"}}}})]})})}},1025:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>l});var s=a(9013),r=a(6787);function l(){return s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,s.jsxs)("div",{className:"text-center",children:[s.jsx("h1",{className:"text-6xl font-bold text-gray-900 mb-4",children:"404"}),s.jsx("h2",{className:"text-2xl font-semibold text-gray-700 mb-6",children:"Page Not Found"}),s.jsx("p",{className:"text-gray-600 mb-8",children:"The page you're looking for doesn't exist or has been moved."}),s.jsx(r.default,{href:"/",className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Go Back Home"})]})})}},1:()=>{}};var t=require("../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),s=t.X(0,[784,891],()=>a(3347));module.exports=s})();